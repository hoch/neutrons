<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gamepad Api</title>
    <link rel="stylesheet" href="styles.css">
    <script src="slides.js" type="module"></script>
    <style>
        .buttons {
            display: flex;
        }

        .button {
            width: 16px;
            height: 16px;
            margin: 0 4px 0 0;
            background-color: #1f545c;
        }

        .button.pressed {
            background-color: #28E5FF;
        }
    </style>
    <script type="module">
        const createUI = (gamepad) => {

            console.log("numAxes", gamepad.axes.length);

            const root = document.createElement("div");
            const label = document.createElement("div");
            label.textContent = gamepad.id;
            root.appendChild(label);

            const buttons = document.createElement("div");
            buttons.className = "buttons";
            for (let i = 0; i < gamepad.buttons.length; i++) {
                const button = document.createElement("div");
                button.className = "button";
                buttons.appendChild(button);
            }
            root.appendChild(buttons);

            const axes = document.createElement("div");
            axes.className = "axes";
            for (let i = 0; i < gamepad.axes.length; i++) {
                const axis = document.createElement("div");
                axis.className = "axis";
                axes.appendChild(axis);
            }
            root.appendChild(axes);
            return {
                domElement: root,
                showButtonState: (index, value) => {
                    const classList = buttons.querySelectorAll(".button")[index].classList;
                    if (value) {
                        classList.add("pressed");
                    } else {
                        classList.remove("pressed");
                    }
                },
                showAxisValue: (index, value) => {
                    const list = axes.querySelectorAll(".axis");
                    list[index].textContent = value;
                }
            };
        };
        const watchGamepad = gamepad => {
            console.log("watchGamepad", gamepad);
            const ui = createUI(gamepad);
            document.querySelector("article").appendChild(ui.domElement);
            const run = () => {
                const gp = navigator.getGamepads()[gamepad.index];
                const axes = gp.axes;
                const buttons = gp.buttons;
                for (let i = 0; i < axes.length; i++) {
                    ui.showAxisValue(i, axes[i]);
                }
                for (let i = 0; i < buttons.length; i++) {
                    ui.showButtonState(i, buttons[i].pressed);
                }
                window.requestAnimationFrame(run);
            };
            run();
        };
        window.addEventListener("gamepadconnected", event => watchGamepad(event.gamepad))
        window.addEventListener("gamepaddisconnected", event => console.log(event.gamepad))
    </script>
</head>
<body>
<header>
    <h1>Klangwerk</h1>
    <h2>Gamepad Api</h2>
</header>
<article>

</article>
<footer></footer>
</body>
</html>